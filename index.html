<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Калькулятор импорта (в белую)</title>

  <style>
    :root{
      --bg:#0b0c10;
      --panel:#11131a;
      --card:#141826;
      --bd:rgba(255,255,255,.08);
      --txt:#f3f4f6;
      --muted:rgba(243,244,246,.68);
      --accent:#7c3aed;
      --accent2:#22c55e;
      --shadow:0 18px 60px rgba(0,0,0,.45);
      --r:16px;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Arial,Helvetica,sans-serif;
      background:radial-gradient(1100px 500px at 15% 0%, rgba(124,58,237,.22), transparent 60%),
                 radial-gradient(900px 500px at 85% 0%, rgba(34,197,94,.16), transparent 60%),
                 var(--bg);
      color:var(--txt);
    }
    .wrap{max-width:1040px;margin:0 auto;padding:18px 14px 28px}
    h1{margin:6px 0 10px;font-size:20px;letter-spacing:-.2px;font-weight:800}
    .sub{margin:0 0 14px;color:var(--muted);font-size:12px;line-height:1.4}

    .card{
      background:linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));
      border:1px solid var(--bd);
      border-radius:var(--r);
      padding:14px;
      margin:10px 0;
      box-shadow:var(--shadow);
    }
    .section-head{display:flex;align-items:center;justify-content:space-between;gap:10px;margin-bottom:10px}
    h2{margin:0;font-size:13px;color:rgba(243,244,246,.9);font-weight:800;letter-spacing:.2px}
    .badge{
      font-size:11px;color:rgba(243,244,246,.75);
      padding:6px 10px;border-radius:999px;
      border:1px solid rgba(255,255,255,.10);
      background:rgba(0,0,0,.18);
      white-space:nowrap;
    }

    label{display:block;font-size:11px;color:var(--muted);margin:0 0 6px}
    input,select{
      width:100%;
      padding:9px 10px;
      border:1px solid rgba(255,255,255,.10);
      background:rgba(15,18,28,.65);
      color:var(--txt);
      border-radius:12px;
      font-size:13px;
      outline:none;
    }
    input:focus,select:focus{border-color:rgba(124,58,237,.55); box-shadow:0 0 0 3px rgba(124,58,237,.18)}
    input[disabled]{opacity:.85;background:rgba(15,18,28,.35)}

    .grid{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    .grid3{display:grid;grid-template-columns:1fr 1fr 1fr;gap:10px}
    .row{display:grid;grid-template-columns:1fr 110px;gap:8px}
    .full{grid-column:1/-1}
    .hint{font-size:11px;color:var(--muted);line-height:1.35;margin-top:6px}

    .switch{display:flex;gap:12px;flex-wrap:wrap;margin:6px 0 8px}
    .switch label{display:flex;gap:8px;align-items:center;margin:0;color:rgba(243,244,246,.75);font-size:12px}
    .switch input{width:auto}

    .totals{display:grid;grid-template-columns:1.2fr 1fr;gap:10px;align-items:stretch}
    .big{
      border:1px solid rgba(255,255,255,.10);
      border-radius:18px;
      padding:14px;
      background:
        radial-gradient(900px 260px at 20% 0%, rgba(124,58,237,.18), transparent 55%),
        radial-gradient(900px 260px at 80% 0%, rgba(34,197,94,.10), transparent 55%),
        rgba(15,18,28,.55);
    }
    .big .t{font-size:11px;color:rgba(243,244,246,.72);margin-bottom:8px}
    .big .v{font-size:28px;font-weight:900;letter-spacing:-.4px}
    .pill{
      display:inline-flex;gap:8px;align-items:center;
      padding:7px 10px;border-radius:999px;
      border:1px solid rgba(255,255,255,.10);
      background:rgba(0,0,0,.18);
      font-size:11px;color:rgba(243,244,246,.85);
      margin-top:10px;
      flex-wrap:wrap;
    }

    .kpis{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    .kpi{
      border:1px solid rgba(255,255,255,.10);
      border-radius:16px;
      padding:12px;
      background:rgba(15,18,28,.45);
    }
    .kpi .t{font-size:11px;color:rgba(243,244,246,.72)}
    .kpi .v{font-size:15px;font-weight:900;margin-top:6px}

    .btns{display:flex;gap:8px;flex-wrap:wrap;margin-top:10px}
    button{
      border:1px solid rgba(255,255,255,.12);
      background:rgba(124,58,237,.95);
      color:#fff;
      padding:9px 12px;
      border-radius:12px;
      cursor:pointer;
      font-size:13px;
      font-weight:800;
    }
    button.secondary{background:rgba(15,18,28,.55);color:rgba(243,244,246,.92)}
    button:hover{filter:brightness(1.06)}
    button:active{transform:translateY(1px)}

    @media(max-width:820px){
      .grid,.grid3,.totals{grid-template-columns:1fr}
      .kpis{grid-template-columns:1fr}
    }
  </style>
</head>

<body>
  <div class="wrap">
    <h1>Калькулятор импорта</h1>
    <div class="sub">
      Официальная схема “в белую”: закупка + расходы до границы + пошлины/антидемпинг + НДС + брокер + довоз по РФ.
      Валюты можно смешивать — итоги считаются в RUB.
    </div>

    <!-- Курсы -->
    <div class="card">
      <div class="section-head">
        <h2>Курсы валют</h2>
        <div class="badge">Итоги в RUB</div>
      </div>
      <div class="grid3">
        <div>
          <label>CNY → RUB</label>
          <input id="rateCNY" value="12.50" inputmode="decimal" />
        </div>
        <div>
          <label>USD → RUB</label>
          <input id="rateUSD" value="95.00" inputmode="decimal" />
        </div>
        <div>
          <label>Валюта расчёта</label>
          <input value="RUB" disabled />
        </div>
      </div>
      <div class="hint">Курс меняй вручную на актуальный — расчёт пересчитается автоматически.</div>
    </div>

    <!-- Товар + Логистика -->
    <div class="card">
      <div class="section-head">
        <h2>Товар и логистика</h2>
        <div class="badge">Смешанные валюты</div>
      </div>

      <div class="grid">
        <div class="full">
          <label>Наименование груза</label>
          <input id="cargoName" placeholder="Например: режущие пластины / обувь / электроника" />
        </div>

        <div>
          <label>Стоимость 1 шт</label>
          <div class="row">
            <input id="unitPrice" value="0" inputmode="decimal" />
            <select id="unitPriceCur">
              <option value="CNY">CNY</option>
              <option value="USD">USD</option>
              <option value="RUB">RUB</option>
            </select>
          </div>
        </div>

        <div>
          <label>Количество, шт</label>
          <input id="qty" value="1" inputmode="numeric" />
        </div>

        <div>
          <label>Вес 1 шт, кг</label>
          <input id="unitWeight" value="0" inputmode="decimal" />
        </div>

        <div>
          <label>Итого закупка (авто)</label>
          <input id="buyTotalOut" disabled />
        </div>

        <div>
          <label>Итого вес (авто)</label>
          <input id="weightTotalOut" disabled />
        </div>

        <div>
          <label>Логистика до границы / до места ввоза</label>
          <div class="row">
            <input id="logBorder" value="0" inputmode="decimal" />
            <select id="logBorderCur">
              <option value="RUB">RUB</option>
              <option value="CNY">CNY</option>
              <option value="USD">USD</option>
            </select>
          </div>
          <div class="hint">Влияет на таможенную стоимость.</div>
        </div>

        <div>
          <label>Страховка до границы (если есть)</label>
          <div class="row">
            <input id="insurance" value="0" inputmode="decimal" />
            <select id="insuranceCur">
              <option value="RUB">RUB</option>
              <option value="CNY">CNY</option>
              <option value="USD">USD</option>
            </select>
          </div>
        </div>

        <div>
          <label>Довоз по РФ (после таможни)</label>
          <div class="row">
            <input id="logRF" value="0" inputmode="decimal" />
            <select id="logRFCur">
              <option value="RUB">RUB</option>
              <option value="CNY">CNY</option>
              <option value="USD">USD</option>
            </select>
          </div>
        </div>

        <div>
          <label>Упаковка / обрешётка (если есть)</label>
          <div class="row">
            <input id="pack" value="0" inputmode="decimal" />
            <select id="packCur">
              <option value="RUB">RUB</option>
              <option value="CNY">CNY</option>
              <option value="USD">USD</option>
            </select>
          </div>
        </div>

        <div class="full hint">
          В “в белую” в таможенную стоимость обычно включают расходы <b>до границы</b>. Довоз по РФ — отдельно.
        </div>
      </div>
    </div>

    <!-- Таможня + Итоги -->
    <div class="card">
      <div class="section-head">
        <h2>Таможня и итог</h2>
        <div class="badge">НДС: % или сумма</div>
      </div>

      <div class="grid">
        <div>
          <label>Пошлина, % (если есть)</label>
          <input id="dutyPct" value="0" inputmode="decimal" />
        </div>

        <div>
          <label>Антидемпинговая пошлина, % (если есть)</label>
          <input id="adPct" value="0" inputmode="decimal" />
        </div>

        <div class="full">
          <label>НДС</label>
          <div class="switch">
            <label><input type="radio" name="vatMode" value="percent" checked /> В процентах</label>
            <label><input type="radio" name="vatMode" value="manual" /> Фиксированная сумма</label>
          </div>

          <div id="vatPercentBlock" class="grid">
            <div>
              <label>НДС, %</label>
              <input id="vatPct" value="20" inputmode="decimal" />
            </div>
            <div class="hint" style="align-self:end">
              База НДС: (тамож.стоимость + пошлина + антидемпинг) × %
            </div>
          </div>

          <div id="vatManualBlock" style="display:none;">
            <label>НДС, сумма</label>
            <div class="row">
              <input id="vatManual" value="0" inputmode="decimal" />
              <select id="vatManualCur">
                <option value="RUB">RUB</option>
                <option value="CNY">CNY</option>
                <option value="USD">USD</option>
              </select>
            </div>
          </div>
        </div>

        <div>
          <label>Услуги брокера</label>
          <div class="row">
            <input id="broker" value="0" inputmode="decimal" />
            <select id="brokerCur">
              <option value="RUB">RUB</option>
              <option value="CNY">CNY</option>
              <option value="USD">USD</option>
            </select>
          </div>
        </div>

        <div class="full">
          <div class="totals">
            <div class="big">
              <div class="t">ИТОГО затрат</div>
              <div class="v" id="grandTotalOut">0 ₽</div>

              <div class="pill">
                Себестоимость:
                <b id="perUnitOut">0 ₽</b><span style="opacity:.7">/шт</span> ·
                <b id="perKgOut">0 ₽/кг</b>
              </div>

              <div class="hint" id="breakdownOut" style="margin-top:10px"></div>

              <div class="btns">
                <button id="copySummary">Скопировать расчёт</button>
                <button class="secondary" id="resetAll">Сбросить</button>
              </div>
            </div>

            <div class="kpis">
              <div class="kpi">
                <div class="t">Таможенная стоимость</div>
                <div class="v" id="customsValueOut">0 ₽</div>
              </div>
              <div class="kpi">
                <div class="t">Таможенные платежи</div>
                <div class="v" id="customsPaymentsOut">0 ₽</div>
                <div class="hint">пошлина + антидемпинг + НДС</div>
              </div>
            </div>
          </div>

          <div class="hint" style="margin-top:10px">
            Формулы: Тамож.стоимость = Закупка + (логистика до границы + страховка до границы). Пошлина/антидемпинг — от тамож.стоимости.
          </div>
        </div>
      </div>
    </div>
  </div>

<script>
(() => {
  const $ = (id) => document.getElementById(id);

  const ids = [
    "rateCNY","rateUSD",
    "cargoName","unitPrice","unitPriceCur","qty","unitWeight",
    "logBorder","logBorderCur","insurance","insuranceCur","logRF","logRFCur","pack","packCur",
    "dutyPct","adPct",
    "vatPct","vatManual","vatManualCur",
    "broker","brokerCur"
  ];

  function n(v){
    if (v === null || v === undefined) return 0;
    const s = String(v).replace(/\s+/g,'').replace(',', '.');
    const x = parseFloat(s);
    return isFinite(x) ? x : 0;
  }

  function rate(cur){
    if (cur === "RUB") return 1;
    if (cur === "CNY") return Math.max(0, n($("rateCNY").value));
    if (cur === "USD") return Math.max(0, n($("rateUSD").value));
    return 1;
  }

  function toRUB(amount, cur){ return n(amount) * rate(cur); }

  function fmtRub(x){
    const v = isFinite(x) ? x : 0;
    return new Intl.NumberFormat('ru-RU', {maximumFractionDigits:0}).format(Math.round(v)) + " ₽";
  }
  function fmtNum(x){
    const v = isFinite(x) ? x : 0;
    return new Intl.NumberFormat('ru-RU', {maximumFractionDigits:3}).format(v);
  }

  function vatMode(){ return document.querySelector('input[name="vatMode"]:checked')?.value || "percent"; }

  function calc(){
    const unitPrice = n($("unitPrice").value);
    const unitCur = $("unitPriceCur").value;
    const qty = Math.max(0, Math.round(n($("qty").value)));
    const unitW = Math.max(0, n($("unitWeight").value));

    const buyRub = toRUB(unitPrice, unitCur) * qty;
    const weightTotal = unitW * qty;

    $("buyTotalOut").value = fmtRub(buyRub);
    $("weightTotalOut").value = fmtNum(weightTotal);

    const logBorderRub = toRUB($("logBorder").value, $("logBorderCur").value);
    const insuranceRub = toRUB($("insurance").value, $("insuranceCur").value);
    const logRFRub = toRUB($("logRF").value, $("logRFCur").value);
    const packRub = toRUB($("pack").value, $("packCur").value);

    const brokerRub = toRUB($("broker").value, $("brokerCur").value);

    const dutyPct = Math.max(0, n($("dutyPct").value));
    const adPct = Math.max(0, n($("adPct").value));

    const customsValue = buyRub + logBorderRub + insuranceRub;

    const duty = customsValue * (dutyPct/100);
    const anti = customsValue * (adPct/100);

    let vat = 0;
    if (vatMode() === "percent") {
      const vatPct = Math.max(0, n($("vatPct").value));
      const vatBase = customsValue + duty + anti;
      vat = vatBase * (vatPct/100);
    } else {
      vat = toRUB($("vatManual").value, $("vatManualCur").value);
    }

    const allLogistics = logBorderRub + insuranceRub + logRFRub + packRub;
    const customsPayments = duty + anti + vat;
    const grand = buyRub + allLogistics + customsPayments + brokerRub;

    $("customsValueOut").textContent = fmtRub(customsValue);
    $("customsPaymentsOut").textContent = fmtRub(customsPayments);
    $("grandTotalOut").textContent = fmtRub(grand);

    const perUnit = qty > 0 ? grand / qty : 0;
    const perKg = weightTotal > 0 ? grand / weightTotal : 0;

    $("perUnitOut").textContent = fmtRub(perUnit);
    $("perKgOut").textContent = (isFinite(perKg) ? fmtRub(perKg).replace(" ₽","") : "0") + " ₽/кг";

    $("breakdownOut").innerHTML =
      `Закупка: <b>${fmtRub(buyRub)}</b> · ` +
      `Логистика: <b>${fmtRub(allLogistics)}</b> · ` +
      `Пошлина: <b>${fmtRub(duty)}</b> · ` +
      `Антидемпинг: <b>${fmtRub(anti)}</b> · ` +
      `НДС: <b>${fmtRub(vat)}</b> · ` +
      `Брокер: <b>${fmtRub(brokerRub)}</b>`;
  }

  ids.forEach(id=>{
    const el = $(id);
    if (!el) return;
    el.addEventListener('input', calc);
    el.addEventListener('change', calc);
  });

  document.querySelectorAll('input[name="vatMode"]').forEach(r=>{
    r.addEventListener('change', ()=>{
      $("vatPercentBlock").style.display = (vatMode()==="percent") ? "grid" : "none";
      $("vatManualBlock").style.display = (vatMode()==="manual") ? "block" : "none";
      calc();
    });
  });

  $("resetAll").addEventListener('click', ()=>{
    $("cargoName").value = "";
    $("unitPrice").value = "0"; $("unitPriceCur").value = "CNY";
    $("qty").value = "1"; $("unitWeight").value = "0";
    $("logBorder").value = "0"; $("logBorderCur").value = "RUB";
    $("insurance").value = "0"; $("insuranceCur").value = "RUB";
    $("logRF").value = "0"; $("logRFCur").value = "RUB";
    $("pack").value = "0"; $("packCur").value = "RUB";
    $("dutyPct").value = "0"; $("adPct").value = "0";
    $("vatPct").value = "20"; $("vatManual").value = "0"; $("vatManualCur").value = "RUB";
    $("broker").value = "0"; $("brokerCur").value = "RUB";
    document.querySelector('input[name="vatMode"][value="percent"]').checked = true;
    $("vatPercentBlock").style.display = "grid";
    $("vatManualBlock").style.display = "none";
    calc();
  });

  $("copySummary").addEventListener('click', async function(){
    calc();
    const text =
`РАСЧЁТ (в белую / официальный импорт)
Груз: ${$("cargoName").value || "-"}
Кол-во: ${$("qty").value} шт
Итого закупка: ${$("buyTotalOut").value}
Итого вес: ${$("weightTotalOut").value} кг

Таможенная стоимость: ${$("customsValueOut").textContent}
Таможенные платежи: ${$("customsPaymentsOut").textContent}

ИТОГО затрат: ${$("grandTotalOut").textContent}
Себестоимость 1 шт: ${$("perUnitOut").textContent}
Себестоимость 1 кг: ${$("perKgOut").textContent}`;
    try{
      await navigator.clipboard.writeText(text);
      this.textContent = "Скопировано ✓";
      setTimeout(()=>this.textContent="Скопировать расчёт",1200);
    }catch(e){
      prompt("Скопируй вручную:", text);
    }
  });

  calc();
})();
</script>
</body>
</html>
