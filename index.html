<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Калькулятор импорта (в белую)</title>

  <style>
    :root{
      --bg:#0b0c10;
      --bd:rgba(255,255,255,.08);
      --txt:#f3f4f6;
      --muted:rgba(243,244,246,.68);
      --accent:#7c3aed;
      --shadow:0 18px 60px rgba(0,0,0,.45);
      --r:16px;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Arial,Helvetica,sans-serif;
      background:radial-gradient(1100px 500px at 15% 0%, rgba(124,58,237,.22), transparent 60%),
                 radial-gradient(900px 500px at 85% 0%, rgba(34,197,94,.16), transparent 60%),
                 var(--bg);
      color:var(--txt);
    }
    .wrap{max-width:1040px;margin:0 auto;padding:18px 14px 28px}
    h1{margin:6px 0 10px;font-size:20px;letter-spacing:-.2px;font-weight:900}
    .sub{margin:0 0 14px;color:var(--muted);font-size:12px;line-height:1.4}

    .card{
      background:linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));
      border:1px solid var(--bd);
      border-radius:var(--r);
      padding:14px;
      margin:10px 0;
      box-shadow:var(--shadow);
    }
    .section-head{display:flex;align-items:center;justify-content:space-between;gap:10px;margin-bottom:10px}
    h2{margin:0;font-size:13px;color:rgba(243,244,246,.9);font-weight:900;letter-spacing:.2px}
    .badge{
      font-size:11px;color:rgba(243,244,246,.75);
      padding:6px 10px;border-radius:999px;
      border:1px solid rgba(255,255,255,.10);
      background:rgba(0,0,0,.18);
      white-space:nowrap;
    }

    label{display:block;font-size:11px;color:var(--muted);margin:0 0 6px}
    input,select{
      width:100%;
      padding:9px 10px;
      border:1px solid rgba(255,255,255,.10);
      background:rgba(15,18,28,.65);
      color:var(--txt);
      border-radius:12px;
      font-size:13px;
      outline:none;
    }
    input:focus,select:focus{border-color:rgba(124,58,237,.55); box-shadow:0 0 0 3px rgba(124,58,237,.18)}
    input[disabled]{opacity:.85;background:rgba(15,18,28,.35)}
    .grid{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    .grid3{display:grid;grid-template-columns:1fr 1fr 1fr;gap:10px}
    .row{display:grid;grid-template-columns:1fr 110px;gap:8px}
    .full{grid-column:1/-1}
    .hint{font-size:11px;color:var(--muted);line-height:1.35;margin-top:6px}

    .switch{display:flex;gap:12px;flex-wrap:wrap;margin:6px 0 8px}
    .switch label{display:flex;gap:8px;align-items:center;margin:0;color:rgba(243,244,246,.75);font-size:12px}
    .switch input{width:auto}

    .totals{display:grid;grid-template-columns:1.25fr 1fr;gap:10px;align-items:stretch}
    .big{
      border:1px solid rgba(255,255,255,.10);
      border-radius:18px;
      padding:14px;
      background:
        radial-gradient(900px 260px at 20% 0%, rgba(124,58,237,.18), transparent 55%),
        radial-gradient(900px 260px at 80% 0%, rgba(34,197,94,.10), transparent 55%),
        rgba(15,18,28,.55);
    }
    .big .t{font-size:11px;color:rgba(243,244,246,.72);margin-bottom:8px}
    .big .v{font-size:28px;font-weight:900;letter-spacing:-.4px}
    .pill{
      display:flex;flex-wrap:wrap;gap:10px;align-items:center;
      padding:9px 10px;border-radius:999px;
      border:1px solid rgba(255,255,255,.10);
      background:rgba(0,0,0,.18);
      font-size:12px;color:rgba(243,244,246,.9);
      margin-top:10px;
    }
    .pill b{font-weight:900}
    .pill .dim{opacity:.72}

    .kpis{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    .kpi{
      border:1px solid rgba(255,255,255,.10);
      border-radius:16px;
      padding:12px;
      background:rgba(15,18,28,.45);
    }
    .kpi .t{font-size:11px;color:rgba(243,244,246,.72)}
    .kpi .v{font-size:15px;font-weight:900;margin-top:6px}
    .kpi .s{margin-top:6px;color:rgba(243,244,246,.62);font-size:11px;line-height:1.35}

    .btns{display:flex;gap:8px;flex-wrap:wrap;margin-top:10px}
    button{
      border:1px solid rgba(255,255,255,.12);
      background:rgba(124,58,237,.95);
      color:#fff;
      padding:9px 12px;
      border-radius:12px;
      cursor:pointer;
      font-size:13px;
      font-weight:900;
    }
    button.secondary{background:rgba(15,18,28,.55);color:rgba(243,244,246,.92)}
    button:hover{filter:brightness(1.06)}
    button:active{transform:translateY(1px)}

    details{border:1px solid rgba(255,255,255,.10);border-radius:14px;padding:10px 12px;background:rgba(15,18,28,.45)}
    details summary{cursor:pointer;color:rgba(243,244,246,.9);font-weight:900;font-size:12px;list-style:none}
    details summary::-webkit-details-marker{display:none}
    .log{
      margin-top:10px;
      font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono",monospace;
      font-size:11px;
      color:rgba(243,244,246,.82);
      white-space:pre-wrap;
      line-height:1.5;
    }

    @media(max-width:820px){
      .grid,.grid3,.totals{grid-template-columns:1fr}
      .kpis{grid-template-columns:1fr}
    }
  </style>
</head>

<body>
  <div class="wrap">
    <h1>Калькулятор импорта</h1>
    <div class="sub">
      Официальная схема “в белую”. Валюты: USD / EUR / CNY / RUB. Итоги считаются в RUB.
      Разделение логистики: “до границы” используется для таможенной стоимости, “до РФ” — для общей себестоимости.
    </div>

    <!-- Курсы -->
    <div class="card">
      <div class="section-head">
        <h2>Курсы валют</h2>
        <div class="badge">Конвертация в RUB</div>
      </div>
      <div class="grid3">
        <div>
          <label>CNY → RUB</label>
          <input id="rateCNY" value="12.50" inputmode="decimal" />
        </div>
        <div>
          <label>USD → RUB</label>
          <input id="rateUSD" value="95.00" inputmode="decimal" />
        </div>
        <div>
          <label>EUR → RUB</label>
          <input id="rateEUR" value="103.00" inputmode="decimal" />
        </div>
      </div>
      <div class="hint">Изменил курс → всё пересчиталось. RUB всегда = 1.</div>
    </div>

    <!-- Товар + Логистика -->
    <div class="card">
      <div class="section-head">
        <h2>Товар и логистика</h2>
        <div class="badge">Авто 1/3 до границы</div>
      </div>

      <div class="grid">
        <div class="full">
          <label>Наименование груза</label>
          <input id="cargoName" placeholder="Например: режущие пластины / обувь / электроника" />
        </div>

        <div>
          <label>Стоимость 1 шт</label>
          <div class="row">
            <input id="unitPrice" value="0" inputmode="decimal" />
            <select id="unitPriceCur">
              <option value="CNY">CNY</option>
              <option value="USD">USD</option>
              <option value="EUR">EUR</option>
              <option value="RUB">RUB</option>
            </select>
          </div>
        </div>

        <div>
          <label>Количество, шт</label>
          <input id="qty" value="1" inputmode="numeric" />
        </div>

        <div>
          <label>Вес 1 шт, кг</label>
          <input id="unitWeight" value="0" inputmode="decimal" />
        </div>

        <div>
          <label>Итого закупка (авто)</label>
          <input id="buyTotalOut" disabled />
        </div>

        <div>
          <label>Итого вес (авто)</label>
          <input id="weightTotalOut" disabled />
        </div>

        <div>
          <label>Логистика до РФ (полная стоимость доставки до РФ)</label>
          <div class="row">
            <input id="logToRF" value="0" inputmode="decimal" />
            <select id="logToRFCur">
              <option value="RUB">RUB</option>
              <option value="CNY">CNY</option>
              <option value="USD">USD</option>
              <option value="EUR">EUR</option>
            </select>
          </div>
          <div class="hint">Идёт в итоговую себестоимость.</div>
        </div>

        <div>
          <label>Логистика до границы (для таможенной стоимости)</label>
          <div class="row">
            <input id="logToBorder" value="0" inputmode="decimal" />
            <select id="logToBorderCur">
              <option value="RUB">RUB</option>
              <option value="CNY">CNY</option>
              <option value="USD">USD</option>
              <option value="EUR">EUR</option>
            </select>
          </div>

          <div class="switch">
            <label><input type="checkbox" id="autoBorder" checked /> Авто: до границы = 1/3 от “до РФ”</label>
          </div>
          <div class="hint">Если “Авто” включён — поле недоступно и считается автоматически.</div>
        </div>

        <div>
          <label>Страховка до границы (отдельной строкой)</label>
          <div class="row">
            <input id="insurance" value="0" inputmode="decimal" />
            <select id="insuranceCur">
              <option value="RUB">RUB</option>
              <option value="CNY">CNY</option>
              <option value="USD">USD</option>
              <option value="EUR">EUR</option>
            </select>
          </div>
          <div class="hint">Участвует и в таможенной стоимости, и в итоговой себестоимости.</div>
        </div>

        <div>
          <label>Упаковка / обрешётка (если есть)</label>
          <div class="row">
            <input id="pack" value="0" inputmode="decimal" />
            <select id="packCur">
              <option value="RUB">RUB</option>
              <option value="CNY">CNY</option>
              <option value="USD">USD</option>
              <option value="EUR">EUR</option>
            </select>
          </div>
        </div>

        <div class="full hint">
          Таможенная стоимость (TS) = Закупка + Логистика до границы + Страховка до границы.
          В итог: Закупка + Логистика до РФ + Страховка + Упаковка + Брокер + Тамож.платежи.
        </div>
      </div>
    </div>

    <!-- Таможня + Итог -->
    <div class="card">
      <div class="section-head">
        <h2>Таможня и итог</h2>
        <div class="badge">Логи для проверки</div>
      </div>

      <div class="grid">
        <div>
          <label>Пошлина, % (если есть)</label>
          <input id="dutyPct" value="0" inputmode="decimal" />
        </div>

        <div>
          <label>Антидемпинговая пошлина, % (если есть)</label>
          <input id="adPct" value="0" inputmode="decimal" />
        </div>

        <div class="full">
          <label>НДС</label>
          <div class="switch">
            <label><input type="radio" name="vatMode" value="percent" checked /> В процентах</label>
            <label><input type="radio" name="vatMode" value="manual" /> Фиксированная сумма</label>
          </div>

          <div id="vatPercentBlock" class="grid">
            <div>
              <label>НДС, %</label>
              <input id="vatPct" value="20" inputmode="decimal" />
            </div>
            <div class="hint" style="align-self:end">
              База НДС = TS + Пошлина + Антидемпинг
            </div>
          </div>

          <div id="vatManualBlock" style="display:none;">
            <label>НДС, сумма</label>
            <div class="row">
              <input id="vatManual" value="0" inputmode="decimal" />
              <select id="vatManualCur">
                <option value="RUB">RUB</option>
                <option value="CNY">CNY</option>
                <option value="USD">USD</option>
                <option value="EUR">EUR</option>
              </select>
            </div>
          </div>
        </div>

        <div>
          <label>Услуги брокера</label>
          <div class="row">
            <input id="broker" value="0" inputmode="decimal" />
            <select id="brokerCur">
              <option value="RUB">RUB</option>
              <option value="CNY">CNY</option>
              <option value="USD">USD</option>
              <option value="EUR">EUR</option>
            </select>
          </div>
        </div>

        <div class="full">
          <div class="totals">
            <div class="big">
              <div class="t">ИТОГО затрат</div>
              <div class="v" id="grandTotalOut">0 ₽</div>

              <div class="pill">
                <span class="dim">Себестоимость за кг:</span> <b id="perKgOut">0 ₽/кг</b>
                <span class="dim">· за шт:</span> <b id="perUnitOut">0 ₽</b><span class="dim">/шт</span>
              </div>

              <div class="hint" id="breakdownOut" style="margin-top:10px"></div>

              <div class="btns">
                <button id="copySummary">Скопировать расчёт</button>
                <button class="secondary" id="resetAll">Сбросить</button>
              </div>
            </div>

            <div class="kpis">
              <div class="kpi">
                <div class="t">Таможенная стоимость (TS)</div>
                <div class="v" id="customsValueOut">0 ₽</div>
                <div class="s">TS = Закупка + Логистика до границы + Страховка</div>
              </div>
              <div class="kpi">
                <div class="t">Таможенные платежи</div>
                <div class="v" id="customsPaymentsOut">0 ₽</div>
                <div class="s">Пошлина + Антидемпинг + НДС</div>
              </div>
            </div>
          </div>

          <details style="margin-top:12px" open>
            <summary>Логи расчёта (для проверки)</summary>
            <div class="log" id="calcLog">—</div>
          </details>
        </div>
      </div>
    </div>
  </div>

<script>
(() => {
  const $ = (id) => document.getElementById(id);

  const ids = [
    "rateCNY","rateUSD","rateEUR",
    "cargoName","unitPrice","unitPriceCur","qty","unitWeight",
    "logToRF","logToRFCur","logToBorder","logToBorderCur","autoBorder",
    "insurance","insuranceCur","pack","packCur",
    "dutyPct","adPct",
    "vatPct","vatManual","vatManualCur",
    "broker","brokerCur"
  ];

  function n(v){
    if (v === null || v === undefined) return 0;
    const s = String(v).replace(/\s+/g,'').replace(',', '.');
    const x = parseFloat(s);
    return isFinite(x) ? x : 0;
  }

  function rate(cur){
    if (cur === "RUB") return 1;
    if (cur === "CNY") return Math.max(0, n($("rateCNY").value));
    if (cur === "USD") return Math.max(0, n($("rateUSD").value));
    if (cur === "EUR") return Math.max(0, n($("rateEUR").value));
    return 1;
  }

  function toRUB(amount, cur){ return n(amount) * rate(cur); }

  function fmtRub(x){
    const v = isFinite(x) ? x : 0;
    return new Intl.NumberFormat('ru-RU', {maximumFractionDigits:0}).format(Math.round(v)) + " ₽";
  }
  function fmtRub2(x){
    const v = isFinite(x) ? x : 0;
    return new Intl.NumberFormat('ru-RU', {minimumFractionDigits:2, maximumFractionDigits:2}).format(v) + " ₽";
  }
  function fmtNum(x){
    const v = isFinite(x) ? x : 0;
    return new Intl.NumberFormat('ru-RU', {maximumFractionDigits:3}).format(v);
  }

  function vatMode(){ return document.querySelector('input[name="vatMode"]:checked')?.value || "percent"; }

  function syncBorderAuto(){
    const auto = $("autoBorder").checked;
    $("logToBorder").disabled = auto;
    $("logToBorderCur").disabled = auto;

    if (!auto) return;

    // Авто: до границы = 1/3 от "до РФ", валюта такая же, как у "до РФ"
    const rfVal = n($("logToRF").value);
    const rfCur = $("logToRFCur").value;

    $("logToBorderCur").value = rfCur;
    $("logToBorder").value = (rfVal / 3).toFixed(2);
  }

  function calc(){
    syncBorderAuto();

    const unitPrice = n($("unitPrice").value);
    const unitCur = $("unitPriceCur").value;

    const qty = Math.max(0, Math.round(n($("qty").value)));
    const unitW = Math.max(0, n($("unitWeight").value));

    const buyRub = toRUB(unitPrice, unitCur) * qty;
    const weightTotal = unitW * qty;

    $("buyTotalOut").value = fmtRub(buyRub);
    $("weightTotalOut").value = fmtNum(weightTotal);

    const logToRFRub = toRUB($("logToRF").value, $("logToRFCur").value);
    const logToBorderRub = toRUB($("logToBorder").value, $("logToBorderCur").value);

    const insuranceRub = toRUB($("insurance").value, $("insuranceCur").value);
    const packRub = toRUB($("pack").value, $("packCur").value);
    const brokerRub = toRUB($("broker").value, $("brokerCur").value);

    const dutyPct = Math.max(0, n($("dutyPct").value));
    const adPct = Math.max(0, n($("adPct").value));

    // Таможенная стоимость (TS)
    const TS = buyRub + logToBorderRub + insuranceRub;

    // Пошлины
    const DUTY = TS * (dutyPct/100);
    const AD = TS * (adPct/100);

    // НДС
    const VAT_BASE = TS + DUTY + AD;

    let VAT = 0;
    if (vatMode() === "percent") {
      const vatPct = Math.max(0, n($("vatPct").value));
      VAT = VAT_BASE * (vatPct/100);
    } else {
      VAT = toRUB($("vatManual").value, $("vatManualCur").value);
    }

    const CUSTOMS_PAYMENTS = DUTY + AD + VAT;

    // Итог (страховка отдельной строкой — добавляем и в итог)
    // GRAND = BUY + LOG_RF + INS + PACK + BROKER + CUSTOMS_PAYMENTS
    const GRAND = buyRub + logToRFRub + insuranceRub + packRub + brokerRub + CUSTOMS_PAYMENTS;

    $("customsValueOut").textContent = fmtRub(TS);
    $("customsPaymentsOut").textContent = fmtRub(CUSTOMS_PAYMENTS);
    $("grandTotalOut").textContent = fmtRub(GRAND);

    const perUnit = qty > 0 ? GRAND / qty : 0;
    const perKg = weightTotal > 0 ? GRAND / weightTotal : 0;

    $("perUnitOut").textContent = fmtRub(perUnit);
    $("perKgOut").textContent = (isFinite(perKg) ? fmtRub(perKg).replace(" ₽","") : "0") + " ₽/кг";

    $("breakdownOut").innerHTML =
      `Закупка: <b>${fmtRub(buyRub)}</b> · ` +
      `Логистика до РФ: <b>${fmtRub(logToRFRub)}</b> · ` +
      `Страховка: <b>${fmtRub(insuranceRub)}</b> · ` +
      `Упаковка: <b>${fmtRub(packRub)}</b> · ` +
      `Пошлина: <b>${fmtRub(DUTY)}</b> · ` +
      `Антидемпинг: <b>${fmtRub(AD)}</b> · ` +
      `НДС: <b>${fmtRub(VAT)}</b> · ` +
      `Брокер: <b>${fmtRub(brokerRub)}</b>`;

    // Логи для проверки
    const logLines = [];
    logLines.push("=== Курсы ===");
    logLines.push(`CNY→RUB = ${rate("CNY")}`);
    logLines.push(`USD→RUB = ${rate("USD")}`);
    logLines.push(`EUR→RUB = ${rate("EUR")}`);
    logLines.push("");
    logLines.push("=== Товар ===");
    logLines.push(`Цена 1 шт: ${unitPrice} ${unitCur} => ${toRUB(unitPrice, unitCur).toFixed(2)} RUB`);
    logLines.push(`Количество: ${qty}`);
    logLines.push(`BUY (закупка) = ${buyRub.toFixed(2)} RUB`);
    logLines.push(`Вес итого = ${weightTotal.toFixed(3)} кг`);
    logLines.push("");
    logLines.push("=== Логистика ===");
    logLines.push(`LOG_RF (до РФ) = ${n($("logToRF").value)} ${$("logToRFCur").value} => ${logToRFRub.toFixed(2)} RUB`);
    logLines.push(`LOG_BORDER (до границы) = ${n($("logToBorder").value)} ${$("logToBorderCur").value} => ${logToBorderRub.toFixed(2)} RUB`);
    logLines.push(`INS_BORDER (страховка) = ${n($("insurance").value)} ${$("insuranceCur").value} => ${insuranceRub.toFixed(2)} RUB`);
    logLines.push(`PACK (упаковка) = ${n($("pack").value)} ${$("packCur").value} => ${packRub.toFixed(2)} RUB`);
    logLines.push(`BROKER = ${n($("broker").value)} ${$("brokerCur").value} => ${brokerRub.toFixed(2)} RUB`);
    logLines.push("");
    logLines.push("=== Таможня (в белую) ===");
    logLines.push("TS = BUY + LOG_BORDER + INS_BORDER");
    logLines.push(`TS = ${buyRub.toFixed(2)} + ${logToBorderRub.toFixed(2)} + ${insuranceRub.toFixed(2)} = ${TS.toFixed(2)} RUB`);
    logLines.push(`DUTY% = ${dutyPct}%  => DUTY = TS * % = ${TS.toFixed(2)} * ${(dutyPct/100).toFixed(4)} = ${DUTY.toFixed(2)} RUB`);
    logLines.push(`AD%   = ${adPct}%    => AD   = TS * % = ${TS.toFixed(2)} * ${(adPct/100).toFixed(4)} = ${AD.toFixed(2)} RUB`);
    logLines.push(`VAT_BASE = TS + DUTY + AD = ${TS.toFixed(2)} + ${DUTY.toFixed(2)} + ${AD.toFixed(2)} = ${VAT_BASE.toFixed(2)} RUB`);

    if (vatMode() === "percent") {
      const vatPct = Math.max(0, n($("vatPct").value));
      logLines.push(`VAT mode = percent (${vatPct}%)`);
      logLines.push(`VAT = VAT_BASE * % = ${VAT_BASE.toFixed(2)} * ${(vatPct/100).toFixed(4)} = ${VAT.toFixed(2)} RUB`);
    } else {
      logLines.push("VAT mode = manual amount");
      logLines.push(`VAT = ${n($("vatManual").value)} ${$("vatManualCur").value} => ${VAT.toFixed(2)} RUB`);
    }

    logLines.push(`CUSTOMS_PAYMENTS = DUTY + AD + VAT = ${DUTY.toFixed(2)} + ${AD.toFixed(2)} + ${VAT.toFixed(2)} = ${CUSTOMS_PAYMENTS.toFixed(2)} RUB`);
    logLines.push("");
    logLines.push("=== Итог ===");
    logLines.push("GRAND = BUY + LOG_RF + INS + PACK + BROKER + CUSTOMS_PAYMENTS");
    logLines.push(`GRAND = ${buyRub.toFixed(2)} + ${logToRFRub.toFixed(2)} + ${insuranceRub.toFixed(2)} + ${packRub.toFixed(2)} + ${brokerRub.toFixed(2)} + ${CUSTOMS_PAYMENTS.toFixed(2)} = ${GRAND.toFixed(2)} RUB`);
    logLines.push(`COST/kg = GRAND / weight_total = ${GRAND.toFixed(2)} / ${weightTotal.toFixed(3)} = ${(weightTotal>0 ? (GRAND/weightTotal).toFixed(2) : 0).toFixed(2)} RUB/kg`);
    logLines.push(`COST/unit = GRAND / qty = ${GRAND.toFixed(2)} / ${qty} = ${(qty>0 ? (GRAND/qty).toFixed(2) : 0).toFixed(2)} RUB/unit`);

    $("calcLog").textContent = logLines.join("\n");
  }

  // listeners
  ids.forEach(id=>{
    const el = $(id);
    if (!el) return;
    el.addEventListener('input', calc);
    el.addEventListener('change', calc);
  });

  // VAT toggle
  document.querySelectorAll('input[name="vatMode"]').forEach(r=>{
    r.addEventListener('change', ()=>{
      $("vatPercentBlock").style.display = (vatMode()==="percent") ? "grid" : "none";
      $("vatManualBlock").style.display = (vatMode()==="manual") ? "block" : "none";
      calc();
    });
  });

  // auto border toggle
  $("autoBorder").addEventListener('change', ()=>{ calc(); });

  $("resetAll").addEventListener('click', ()=>{
    $("cargoName").value = "";
    $("unitPrice").value = "0"; $("unitPriceCur").value = "CNY";
    $("qty").value = "1"; $("unitWeight").value = "0";

    $("logToRF").value = "0"; $("logToRFCur").value = "RUB";
    $("logToBorder").value = "0"; $("logToBorderCur").value = "RUB";
    $("autoBorder").checked = true;

    $("insurance").value = "0"; $("insuranceCur").value = "RUB";
    $("pack").value = "0"; $("packCur").value = "RUB";

    $("dutyPct").value = "0"; $("adPct").value = "0";
    $("vatPct").value = "20"; $("vatManual").value = "0"; $("vatManualCur").value = "RUB";
    document.querySelector('input[name="vatMode"][value="percent"]').checked = true;
    $("vatPercentBlock").style.display = "grid";
    $("vatManualBlock").style.display = "none";

    $("broker").value = "0"; $("brokerCur").value = "RUB";

    calc();
  });

  $("copySummary").addEventListener('click', async function(){
    calc();
    const text =
`РАСЧЁТ (в белую / официальный импорт)
Груз: ${$("cargoName").value || "-"}
Кол-во: ${$("qty").value} шт
Итого закупка: ${$("buyTotalOut").value}
Итого вес: ${$("weightTotalOut").value} кг

Таможенная стоимость (TS): ${$("customsValueOut").textContent}
Таможенные платежи: ${$("customsPaymentsOut").textContent}

ИТОГО затрат: ${$("grandTotalOut").textContent}
Себестоимость за кг: ${$("perKgOut").textContent}
Себестоимость за шт: ${$("perUnitOut").textContent}`;
    try{
      await navigator.clipboard.writeText(text);
      this.textContent = "Скопировано ✓";
      setTimeout(()=>this.textContent="Скопировать расчёт",1200);
    }catch(e){
      prompt("Скопируй вручную:", text);
    }
  });

  // initial
  calc();
})();
</script>
</body>
</html>
